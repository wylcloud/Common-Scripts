# 启用 BBR 拥塞控制算法
net.ipv4.tcp_congestion_control = bbr

# 启用 TCP 时间戳
net.ipv4.tcp_timestamps = 1

# 设置 SYN 包的重试次数
net.ipv4.tcp_syn_retries = 3

# 设置 SYN-ACK 包的重试次数
net.ipv4.tcp_synack_retries = 3

# 设置 TCP 连接失败前的重试次数
net.ipv4.tcp_retries2 = 5

# 配置 TCP KeepAlive 设置
net.ipv4.tcp_keepalive_time = 300
net.ipv4.tcp_keepalive_probes = 2
net.ipv4.tcp_keepalive_intvl = 2

# 启用 TCP 窗口缩放
net.ipv4.tcp_window_scaling = 1

# 禁用自动 TCP 窗口大小调整
net.ipv4.tcp_adv_win_scale = -2

# 启用选择性确认（SACK）和前向确认（FACK）
net.ipv4.tcp_sack = 1
net.ipv4.tcp_fack = 1

# 关闭闲置连接的慢启动
net.ipv4.tcp_slow_start_after_idle = 0

# 启用 MTU 探测
net.ipv4.tcp_mtu_probing = 1

# 设置 TCP FIN 超时时间
net.ipv4.tcp_fin_timeout = 30

# 允许重用处于 TIME-WAIT 状态的套接字
net.ipv4.tcp_tw_reuse = 1

# 设置可被接受连接的最大队列长度
net.core.somaxconn = 32768

# 设置接收网络包的最大排队长度
net.core.netdev_max_backlog = 32768

# 默认和最大的 TCP 套接字发送/接收缓冲区大小
net.core.wmem_default = 44040192
net.core.rmem_default = 44040192
net.ipv4.tcp_rmem = 8192 87380 25165824
net.core.rmem_max = 25165824

# TCP 套接字的最小、默认和最大缓冲区大小
net.core.wmem_max = 12582912
net.ipv4.tcp_wmem = 4096 65536 12582912

# 启用 SYN cookies，防御 SYN 洪水攻击
net.ipv4.tcp_syncookies = 1

# 配置反向路径过滤，帮助防止 IP 欺骗
net.ipv4.conf.default.rp_filter = 2
net.ipv4.conf.all.rp_filter = 2

# 启用对可疑数据包的日志记录（源地址欺骗或重定向）
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.log_martians = 1

# 禁用接受源路由的数据包，增强安全性
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0

# ARP 报文发送规则配置
net.ipv4.conf.default.arp_announce = 2
net.ipv4.conf.lo.arp_announce = 2
net.ipv4.conf.all.arp_announce = 2

# 增加系统文件描述符限制
fs.file-max = 1048575

# 增加用户可创建的 inotify 实例限制
fs.inotify.max_user_instances = 8192

# 配置垃圾收集器更积极地清理路由
net.ipv4.route.gc_timeout = 100

# 系统发生严重错误后自动重启
kernel.panic = 1

# 配置系统核心转储文件的生成格式
kernel.core_pattern = core_%e

# 内存不足时自动触发系统崩溃
vm.panic_on_oom = 1

# 控制内存过量分配
vm.overcommit_memory = 1

# 调整系统交换行为的倾向
vm.swappiness = 10

# 设置系统 dirty 内存的比例
vm.dirty_ratio = 10

# 调整系统文件系统缓存的压力
vm.vfs_cache_pressure = 250

# 设置系统允许的最大共享内存段大小
kernel.shmmax = 4294967296

# 设置系统在任何给定时刻可以使用的共享内存总量
kernel.shmall = 1073741824

# 决定是否开启内核响应魔术键
kernel.sysrq = 1

# 控制内存回收机制
vm.zone_reclaim_mode = 0

# 启用 IP 转发
net.ipv4.ip_forward = 1
